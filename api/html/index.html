<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Extended Kalman Filter: Extended Kalman Filter Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Extended Kalman Filter
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Extended Kalman Filter Project by Tony Lin</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Extended Kalman Filter Project </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Content of the Submission and Usage</h2>
<p>This submission includes the following c++ files:</p><ul>
<li><a class="el" href="main_8cpp.html">main.cpp</a>: the main function that communicate with the simulator and drive the estimation process using EKF.</li>
<li><a class="el" href="FusionEKF_8h.html">filter/FusionEKF.h</a>, <a class="el" href="FusionEKF_8cpp.html">filter/FusionEKF.cpp</a>: contains EKF implementation</li>
<li><a class="el" href="KalmanFilter_8h.html">filter/KalmanFilter.h</a>, <a class="el" href="KalmanFilter_8cpp.html">filter/KalmanFilter.cpp</a>]: contains the base Kalman filter implementation</li>
<li><a class="el" href="utils_8h.html">filter/utils.h</a>, <a class="el" href="utils_8cpp.html">filter/utils.cpp</a>]: contains some utility functions used by <a class="el" href="classFusionEKF.html">FusionEKF</a></li>
<li><a class="el" href="RMSEEvaluator_8h.html">performance/RMSEEvaluator.h</a>: A template class for memory-efficient evaluation of RMSE</li>
<li><a class="el" href="SensorType_8h.html">sensor/SensorType.h</a>: defines SensorType enum</li>
<li><a class="el" href="MeasurementPackage_8h.html">sensor/MeasurementPackage.h</a> defines sensor measurement package structure</li>
</ul>
<h3>Usage</h3>
<p>To start the program: </p><pre class="fragment">./ExtendedKF
</pre><p>The program will listen on port 4567 for an incoming simulator connection. Only one simulator should be connected at anytime, though the program does not prohibit it. To start a new simulator, terminate the existing one first, then start a new one.</p>
<p>To start the simulator:</p>
<h4>On Windows</h4>
<pre class="fragment">term2_sim9.exe path_to_obj_pose-laser-radar-synthetic-input.txt
</pre><h4>Other platforms:</h4>
<pre class="fragment">./term2_sim9 path_to_obj_pose-laser-radar-synthetic-input.txt
</pre><h4>Run multiple simulations</h4>
<p><em>ExtendedKF</em> allows one to run multiple simulations, whether from the same simulator or different simulators, one at a time without having to restart it. This allows the RMSE to be evaluated for a much bigger set of estimates.</p>
<h4>Build ExtendedKF</h4>
<p>Follow the <em>Basic Build Instructions</em> described in README.md to build ExtendedKF. For Windows, Bash on Ubuntu on Windows should be used. Please follow the <em>Tips for Setting Up Your Environment</em> on how to setup and configure the build environment.</p>
<p>The program can be built to output more information for disgnosis purpose by defining <b>VERBOSE_OUT</b> macro.</p>
<h4>Build API Documentation</h4>
<p>The documentation for functions, classes and methods are included in the header files in Doxygen format. To generate Api documentation with the included doxygen.cfg:</p>
<ol type="1">
<li>Make sure doxygen is installed</li>
<li>cd to the root folder of this project</li>
</ol>
<ol type="1">
<li><p class="startli">Issue the following command:</p>
<p class="startli">doxygen doxygen.cfg</p>
</li>
</ol>
<h2>The Implementation</h2>
<h3>The source code structure</h3>
<p>The src folder contains three folders for the source files: . filter: contains <a class="el" href="classKalmanFilter.html">KalmanFilter</a>.[h,cpp], <a class="el" href="classFusionEKF.html">FusionEKF</a>.[h,cpp], and utils.[h,cpp] files which implement the Extended Kalman Filter. . performance: contains <a class="el" href="RMSEEvaluator_8h.html">RMSEEvaluator.h</a> which provides RMSE evaluation functionality. . sensor: contains source code for defining sensor measurement.</p>
<h5>File names</h5>
<p>In this project, I made a class to have its own .h, and .cpp files. More specifically, a class source file contains exactly one class, and has the same name as the class it contains. On the other hand,</p>
<h4>The libs folder</h4>
<p>The libs folder contains Eigen and json.hpp required by the program.</p>
<h3><a class="el" href="classKalmanFilter.html">KalmanFilter</a> class</h3>
<p>This class implement the baseline Kalman filter functionalities including the predict, update functions.</p>
<p>It's data members include the estimation state, state transition matrix, the measurement matrix, and the covariance matrices. Getter and setter functions for some of them are provided. Refer to the API documentation for <a href="api/html/classKalmanFilter.html">KalmanFilter</a>.</p>
<h3><a class="el" href="classFusionEKF.html">FusionEKF</a> class</h3>
<p>This class implement the extended Kalman filter functionalities. It extends <a class="el" href="classKalmanFilter.html">KalmanFilter</a> class and implements <em>ProcessMeasurement()</em> methods.</p>
<p>The extended Kalman filter update for Radar measurement is implemented in method <em>UpdateEKF()</em>.</p>
<p>The Jacobian matrix for the Radar measurement matrix is computed in method <em>CalculateJacobian()</em>.</p>
<p>The API documentation for <a class="el" href="classFusionEKF.html">FusionEKF</a> can be found <a href="api/html/classKalmanFilter.html">here</a>.</p>
<h4>Angular correction for radar estimates</h4>
<p>The radar measurement's bearing angle is expected to lie between [ &amp;#960;, -&amp;#960; ). This has to be enforced for radar measurements even though they are expected to fall into this range, but some exceptions are seen in the supplied data file for this project.</p>
<p>In addition to the bearing angle, the angular difference between predictions and measurements needs to aligned to be within this range which is also the minimum angle to move from one angle to the other.</p>
<p>Failing to align the angles correctly will severely degrade the accuracy of the estimation.</p>
<h4>The Extended Kalman Filter Process</h4>
<p>The process is implemented in method <em>ProcessMeasurement()</em>.</p>
<h5>Initialization</h5>
<p>The <a class="el" href="classFusionEKF.html">FusionEKF</a> is initialized upon receiving the first measurement.</p>
<p>If the first measurement is from radar. The state is computed from the radar's measurement using <a class="el" href="namespaceutils.html#acb963513defeb0f193b8ae1bf232695f">utils::RadarToPV()</a> function.</p>
<p>If the first measurement is from lidar, the measured position is used to populate the state with acceleration 0.</p>
<p>The <em>ProcessMeasurement()</em> method returns after the initialized is completed.</p>
<h5>Prediction</h5>
<p>After initialization, a prediction is performed for a new measurement if the time elapsed since the previoud measurement is above a small threshold (defined in constant MINIMAL_TIME_THRESHOLD) in the implementation.</p>
<p>The prediction process is identical for radar and lidar measurements. It starts by computing the state transition matrix and the process covariance matrix.</p>
<p>Then the Predict() method (implemented in <a class="el" href="classKalmanFilter.html">KalmanFilter</a> class) is invoked.</p>
<p>Finally, the update process is launched.</p>
<h5>Update</h5>
<p>The update process is always performed for every measurement after initialization.</p>
<p>Lidar measurement is carried out by <em><a class="el" href="classKalmanFilter.html#a1215aa5d9990de0780a203c3ee8e94ba">KalmanFilter::Update()</a></em> method.</p>
<p>Radar measurement is updated with <em><a class="el" href="classFusionEKF.html#aca9ccbc481f59e8cc6dc7c0cd146ee2b">FusionEKF::UpdateEKF()</a></em> method. It calls <em>CalculateJacobian()</em> to compute the Jacobian matrix, and <em><a class="el" href="namespaceutils.html#aa4874e8681205181cdb73e8c3c23e325">utils::PVToRadar()</a></em> to convert state values to radar values. Angular correction described above is performed on:</p>
<ol type="1">
<li>The measurement's bearing angle</li>
<li>The difference between the measurement's bearing angle and the prediction's bearing angle.</li>
</ol>
<h3><a class="el" href="classRMSEEvaluator.html">RMSEEvaluator</a> class</h3>
<p>The RMSE evaluation implemented in the starter code is not efficient as it keeps all past measurements and estimates in a list, and evaluate RMSE for every new measurement on the entire list.</p>
<p>The purpose of this class is to implement a more efficient RMSE mechanism that does not need to store past measurements and estimates. It maintains current sum of the square errors, and total number of past estimates. RMSE for a new estimate can be simply obtained by taking the square root of the mean of square error.</p>
<h2>Result</h2>
<p>The RMSE performance of the implementation is averaged as follows after running dataset 1 followed by dataset 2:</p>
<table class="doxtable">
<tr>
<th align="center"></th><th align="center">RMSE  </th></tr>
<tr>
<td align="center">X </td><td align="center">0.0876 </td></tr>
<tr>
<td align="center">Y </td><td align="center">0.0913 </td></tr>
<tr>
<td align="center">Vx </td><td align="center">0.4357 </td></tr>
<tr>
<td align="center">Vy </td><td align="center">0.4678 </td></tr>
</table>
<p>Refer to <a href="video1.mp4">video1.mp4</a>.</p>
<p>Subsequent tests by repeating both dataset multiple times is shown in <a href="video2.mp4">video2.mp4</a></p>
<h3>Discussion and further works</h3>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
